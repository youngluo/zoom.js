/**
 * Pure JavaScript implementation of zoom.js.
 * 
 * Bundle of @youngluo/zoom.js
 * Generated: 2017-06-13
 * Version: 1.0.0
 * 
 * This is a fork of the original zoom.js implementation by @Nishanth.
 * 
 * Copyright (c) 2016 Nishanth Shanmugham.
 * Copyright Â© 2017 Young Luo.
 */

!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e=function(){return document.documentElement.clientWidth},n=function(){return document.documentElement.clientHeight},i=function(t){var e=t.getBoundingClientRect(),n=document.documentElement,i=window;return{top:e.top+i.pageYOffset-n.clientTop,left:e.left+i.pageXOffset-n.clientLeft}},o=function(t,e,n){var i=function t(i){i.target.removeEventListener(e,t),n()};t.addEventListener(e,i)},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function a(e,n){t(this,a),this.img=e,this.preservedTransform=e.style.transform,this.wrap=null,this.overlay=null,this.offset=n}return s(a,[{key:"forceRepaint",value:function(){this.img.offsetWidth}},{key:"zoom",value:function(){this.wrap=document.createElement("div"),this.wrap.classList.add("zoom-img-wrap"),this.img.parentNode.insertBefore(this.wrap,this.img),this.wrap.appendChild(this.img),this.img.classList.add("zoom-img"),this.img.setAttribute("data-action","zoom-out"),this.overlay=document.createElement("div"),this.overlay.classList.add("zoom-overlay"),document.body.appendChild(this.overlay),this.forceRepaint();var t=this.calculateScale();this.forceRepaint(),this.animate(t),document.body.classList.add("zoom-overlay-open")}},{key:"calculateScale",value:function(){var t=e()-this.offset,i=n()-this.offset;return this.img.width/this.img.height<t/i?i/this.img.height:t/this.img.width}},{key:"animate",value:function(t){var o=i(this.img),s=window.pageYOffset,a=e()/2,r=s+n()/2,c="scale("+t+")",l="translate3d("+(a-(o.left+this.img.width/2))+"px, "+(r-(o.top+this.img.height/2))+"px, 0px)";this.img.style.transform=c,this.wrap.style.transform=l}},{key:"dispose",value:function(){null!=this.wrap&&null!=this.wrap.parentNode&&(this.img.classList.remove("zoom-img"),this.img.setAttribute("data-action","zoom"),this.wrap.parentNode.insertBefore(this.img,this.wrap),this.wrap.parentNode.removeChild(this.wrap),document.body.removeChild(this.overlay),document.body.classList.remove("zoom-overlay-transitioning"))}},{key:"close",value:function(){var t=this;document.body.classList.add("zoom-overlay-transitioning"),this.img.style.transform=this.preservedTransform,0===this.img.style.length&&this.img.removeAttribute("style"),this.wrap.style.transform="none",o(this.img,"transitionend",function(){t.dispose(),document.body.classList.remove("zoom-overlay-open")})}}]),a}(),r=null,c=-1,l=-1,u=function(t){t.addEventListener("click",d)},d=function(t){document.body.classList.contains("zoom-overlay-open")||(t.metaKey||t.ctrlKey?window.open(t.target.getAttribute("data-original")||t.target.src,"_blank"):t.target.width>=e()-80||(m(!0),(r=new a(t.target,80)).zoom(),h()))},m=function(t){null!=r&&(t?r.dispose():r.close(),f(),r=null)},h=function(){document.addEventListener("scroll",v),document.addEventListener("keyup",p),document.addEventListener("touchstart",g),document.addEventListener("click",w,!0)},f=function(){document.removeEventListener("scroll",v),document.removeEventListener("keyup",p),document.removeEventListener("touchstart",g),document.removeEventListener("click",w,!0)},v=function(){-1==c&&(c=window.pageYOffset),Math.abs(c-window.pageYOffset)>=40&&m()},p=function(t){27==t.keyCode&&m()},g=function(t){var e=t.touches[0];null!=e&&(l=e.pageY,t.target.addEventListener("touchmove",y))},y=function t(e){var n=e.touches[0];null!=n&&Math.abs(n.pageY-l)>10&&(m(),e.target.removeEventListener("touchmove",t))},w=function(){m()},L=Object.create(null);L.setup=u,document.addEventListener("DOMContentLoaded",function(){for(var t=document.querySelectorAll("img[data-action='zoom']"),e=0;e<t.length;e++)L.setup(t[e])})}();
